<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最后通牒者实验 - 虚拟币版本</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f8961e;
            --danger: #e63946;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        
        .container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            width: 100%;
            height: 100vh;
            max-width: none;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }
        
        .screen {
            padding: 40px;
            display: none;
            flex: 1;
            overflow-y: auto;
        }
        
        .active {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .center-content {
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 3rem;
            position: relative;
            padding-bottom: 20px;
        }
        
        h1:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 5px;
            background: var(--primary);
            border-radius: 3px;
        }
        
        h2 {
            color: var(--secondary);
            margin-bottom: 25px;
            font-size: 2.5rem;
        }
        
        h3 {
            color: var(--secondary);
            margin: 20px 0 15px;
            font-size: 1.6rem;
        }
        
        .instructions {
            background: var(--light);
            padding: 35px;
            border-radius: 20px;
            margin: 35px 0;
            text-align: left;
            font-size: 1.4rem;
            line-height: 1.8;
            border-left: 6px solid var(--primary);
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .instructions p {
            margin-bottom: 20px;
        }
        
        .instructions ul {
            margin-left: 30px;
            margin-bottom: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        .input-group {
            margin: 35px 0;
        }
        
        input[type="text"] {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            font-size: 1.4rem;
            border: 2px solid #ddd;
            border-radius: 12px;
            text-align: center;
            margin: 15px 0;
            transition: all 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(67, 97, 238, 0.2);
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 1.4rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 15px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-accept {
            background: var(--success);
        }
        
        .btn-reject {
            background: var(--danger);
        }
        
        .btn-accept:hover {
            background: #3aa8d5;
        }
        
        .btn-reject:hover {
            background: #c1121f;
        }
        
        .response-keys {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .key {
            padding: 20px 40px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            font-weight: bold;
            min-width: 200px;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .proposal-display {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
            font-size: 2.5rem;
            font-weight: bold;
            border: 4px solid var(--primary);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .feedback {
            background: var(--light);
            padding: 35px;
            border-radius: 20px;
            margin: 35px 0;
            font-size: 2rem;
            font-weight: bold;
            border-left: 6px solid var(--primary);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .network-connecting {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 40px 0;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .progress-container {
            width: 100%;
            max-width: 800px;
            background: #e9ecef;
            border-radius: 12px;
            margin: 30px auto;
            height: 20px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 12px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .trial-counter {
            background: var(--light);
            padding: 15px 30px;
            border-radius: 25px;
            display: inline-block;
            margin: 20px 0;
            font-weight: bold;
            color: var(--dark);
            font-size: 1.3rem;
        }
        
        .cross {
            font-size: 6rem;
            margin: 40px 0;
            color: var(--dark);
        }
        
        .image-container {
            width: 100%;
            height: 100vh;
            margin: 0;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-color: #000;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        
        .trial-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .fairness-scale {
            margin: 40px 0;
            padding: 30px;
            background: var(--light);
            border-radius: 20px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .scale-options {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .scale-option {
            text-align: center;
            flex: 1;
        }
        
        .scale-option input {
            margin: 15px 0;
            transform: scale(1.8);
        }
        
        .scale-option label {
            font-size: 1.2rem;
        }
        
        .data-display {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            text-align: left;
            font-size: 1.1rem;
        }
        
        .space-hint {
            margin-top: 30px;
            color: #6c757d;
            font-size: 1.2rem;
        }
        
        /* 新增样式 */
        .demographics-form {
            max-width: 800px;
            margin: 0 auto;
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            font-size: 1.3rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .gender-options {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .gender-option {
            flex: 1;
            text-align: center;
        }
        
        .gender-option input {
            display: none;
        }
        
        .gender-option label {
            display: block;
            padding: 20px;
            background: var(--light);
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.3rem;
            font-weight: normal;
        }
        
        .gender-option input:checked + label {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .comprehension-question {
            background: var(--light);
            padding: 30px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }
        
        .comprehension-question h3 {
            margin-bottom: 20px;
            color: var(--secondary);
        }
        
        .comprehension-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .comprehension-option {
            display: flex;
            align-items: center;
        }
        
        .comprehension-option input {
            margin-right: 15px;
            transform: scale(1.5);
        }
        
        .comprehension-option label {
            font-size: 1.3rem;
        }
        
        .questionnaire-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
        }
        
        .questionnaire-table th, .questionnaire-table td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
        }
        
        .questionnaire-table th {
            background: var(--primary);
            color: white;
        }
        
        .questionnaire-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .questionnaire-table input[type="radio"] {
            transform: scale(1.5);
        }
        
        .copy-email {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            margin: 15px 0;
        }
        
        .copy-email:hover {
            background: var(--secondary);
        }
        
        .email-instructions {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }
        
        @media (max-width: 1200px) {
            h1 {
                font-size: 2.5rem;
            }
            
            h2 {
                font-size: 2rem;
            }
            
            .instructions {
                font-size: 1.2rem;
                padding: 25px;
            }
            
            .proposal-display {
                font-size: 2rem;
                padding: 30px;
            }
            
            .key {
                min-width: 180px;
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }
            
            .screen {
                padding: 25px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.7rem;
            }
            
            .proposal-display {
                font-size: 1.7rem;
                padding: 20px;
            }
            
            .response-keys {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .key {
                width: 100%;
                max-width: 300px;
                font-size: 1.1rem;
            }
            
            .btn {
                padding: 15px 30px;
                font-size: 1.2rem;
            }
            
            .gender-options {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 屏幕1: 参与者编号输入 -->
        <div id="screen1" class="screen active">
            <div class="center-content">
                <h1>最后通牒者实验</h1>
                <div class="instructions">
                    <p>欢迎参加本次心理学实验！本研究旨在探索人们在资源分配情境中的决策行为。</p>
                </div>
                <div class="input-group">
                    <p>请输入您的实验编号：</p>
                    <input type="text" id="participant-id" placeholder="例如: P001">
                </div>
                <button class="btn" onclick="showDemographics()">开始实验</button>
                <p class="space-hint">提示：在实验过程中，您可以使用空格键继续</p>
            </div>
        </div>
        
        <!-- 屏幕2: 人口学信息 -->
        <div id="screen2" class="screen">
            <div class="center-content">
                <h1>基本信息填写</h1>
                <div class="demographics-form">
                    <div class="form-group">
                        <label for="age">年龄：</label>
                        <input type="text" id="age" placeholder="请输入您的年龄（整数）" oninput="validateAge(this)">
                    </div>
                    
                    <div class="form-group">
                        <label>性别：</label>
                        <div class="gender-options">
                            <div class="gender-option">
                                <input type="radio" id="male" name="gender" value="男">
                                <label for="male">男</label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="female" name="gender" value="女">
                                <label for="female">女</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="major">专业：</label>
                        <select id="major">
                            <option value="">请选择您的专业</option>
                            <option value="01哲学">01哲学</option>
                            <option value="02经济学">02经济学</option>
                            <option value="03法学">03法学</option>
                            <option value="04教育学">04教育学</option>
                            <option value="05文学">05文学</option>
                            <option value="06历史学">06历史学</option>
                            <option value="07理学">07理学</option>
                            <option value="08工学">08工学</option>
                            <option value="09农学">09农学</option>
                            <option value="10医学">10医学</option>
                            <option value="11军事">11军事</option>
                            <option value="12管理学">12管理学</option>
                            <option value="13艺术学">13艺术学</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="education">学历：</label>
                        <select id="education">
                            <option value="">请选择您的学历</option>
                            <option value="高中及以下">高中及以下</option>
                            <option value="大学专科">大学专科</option>
                            <option value="大学本科">大学本科</option>
                            <option value="硕士研究生以上">硕士研究生以上</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="health">健康状态：</label>
                        <select id="health">
                            <option value="良好" selected>良好</option>
                            <option value="一般">一般</option>
                            <option value="较差">较差</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="saveDemographics()">确认并继续</button>
            </div>
        </div>
        
        <!-- 屏幕3: 实验说明 -->
        <div id="screen3" class="screen">
            <div class="center-content">
                <h1>实验说明</h1>
                <div class="instructions">
                    <p><strong>同学，您好！</strong></p>
                    <p>欢迎参与本次心理学行为实验。在本实验中，您将有机会通过完成决策任务获得一笔额外的现金报酬。您的所有决策都将被严格保密，仅用于学术研究。</p>
                    
                    <h3>任务说明：</h3>
                    <p><strong>任务角色：</strong>在接下来的任务中，您将扮演"回应者"的角色。系统会随机将您与另一位匿名的"提议者"配对。</p>
                    <p><strong>分配方案：</strong>在每一轮任务中，您和提议者将共同分配一笔<strong>【10元钱】</strong>。提议者会提出一个分配方案，例如："他得8元，您得2元"。</p>
                    
                    <h3>您的权力与决策：</h3>
                    <p>看到方案后，您需要决定：</p>
                    <ul>
                        <li><strong>"接受"</strong>：如果您接受该方案，则双方按照该方案获得相应的金额。</li>
                        <li><strong>"拒绝"</strong>：如果您拒绝该方案，则本轮您和提议者都得不到任何钱，收益为0。</li>
                    </ul>
                    <p>您将完成若干轮类似的决策。</p>
                    
                    <h3>报酬说明：</h3>
                    <p>实验结束后，系统将从您完成的所有轮次中随机抽取一轮，并按照您在该轮次的实际收益作为您的额外报酬。因此，请认真对待您的每一个决策，因为它将直接关系到您最终能获得的报酬。</p>
                    
                    <h3>关键提醒：</h3>
                    <ul>
                        <li>您的配对对象是真实存在的其他参与者。</li>
                        <li>请根据您自身的真实想法进行选择，答案没有对错之分。</li>
                        <li>在任务过程中，我们还会请您对分配方案的公平性进行评价。</li>
                    </ul>
                    <p>如果您已完全理解上述规则，请点击下方按钮开始练习环节，以熟悉操作流程。</p>
                </div>
                <button class="btn" onclick="startNetwork()">理解，继续</button>
                <p class="space-hint">按空格键继续</p>
            </div>
        </div>
        
        <!-- 屏幕4: 网络连接 -->
        <div id="screen4" class="screen">
            <div class="center-content">
                <h1>正在连接服务器...</h1>
                <div class="network-connecting">● ● ●</div>
                <p>请稍候，正在为您匹配参与者...</p>
            </div>
        </div>
        
        <!-- 屏幕5: 匹配成功 -->
        <div id="screen5" class="screen">
            <div class="center-content">
                <h1>匹配成功！</h1>
                <div class="instructions">
                    <p>您已与 <span id="matched-participant" style="color: var(--primary); font-weight: bold;">XX</span> 号参与者连接成功！</p>
                </div>
                <button class="btn" onclick="startPractice()">开始练习</button>
                <p class="space-hint">按空格键继续</p>
            </div>
        </div>
        
        <!-- 屏幕6: 练习阶段 -->
        <div id="screen6" class="screen">
            <div class="center-content">
                <h2>练习阶段</h2>
                <div class="trial-counter">练习试次</div>
                <div class="proposal-display" id="practice-proposal">
                    对方得到: 5虚拟币<br>
                    您得到: 5虚拟币
                </div>
                <p>请做出决定：</p>
                <div class="response-keys">
                    <button class="btn btn-accept" onclick="practiceDecision('accept')">接受 (F键)</button>
                    <button class="btn btn-reject" onclick="practiceDecision('reject')">拒绝 (J键)</button>
                </div>
            </div>
        </div>
        
        <!-- 屏幕7: 练习反馈 -->
        <div id="screen7" class="screen">
            <div class="center-content">
                <h2>练习反馈</h2>
                <div class="feedback" id="practice-feedback">
                    您接受该提议，对方得到5虚拟币，您得到5虚拟币
                </div>
                <p>是否继续练习？</p>
                <div class="response-keys">
                    <button class="btn" onclick="startExperiment()">进入正式实验 (空格键)</button>
                    <button class="btn" onclick="continuePractice()">继续练习 (Q键)</button>
                </div>
                <p class="space-hint">按空格键进入正式实验，按Q键继续练习</p>
            </div>
        </div>
        
        <!-- 屏幕8: 正式实验 -->
        <div id="screen8" class="screen">
            <div class="center-content">
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="trial-counter" id="trial-counter">试次 1 / 20</div>
                
                <!-- 注视点 -->
                <div id="fixation">
                    <div class="cross">+</div>
                </div>
                
                <!-- 分配方案 -->
                <div id="proposal" style="display: none;">
                    <h2>对方提议</h2>
                    <div class="proposal-display" id="trial-proposal">
                        对方得到: 5虚拟币<br>
                        您得到: 5虚拟币
                    </div>
                    <p>请做出决定：</p>
                    <div class="response-keys">
                        <button class="btn btn-accept" onclick="makeDecision('accept')">接受 (F键)</button>
                        <button class="btn btn-reject" onclick="makeDecision('reject')">拒绝 (J键)</button>
                    </div>
                </div>
                
                <!-- 反馈 -->
                <div id="feedback" style="display: none;">
                    <div class="feedback" id="trial-feedback">
                        您接受该提议，对方得到5虚拟币，您得到5虚拟币
                    </div>
                </div>
                
                <!-- 公平性评分 -->
                <div id="fairness-rating" style="display: none;">
                    <h2>公平性评价</h2>
                    <div class="fairness-scale">
                        <p>您觉得刚才对方提议：</p>
                        <div class="scale-options">
                            <div class="scale-option">
                                <input type="radio" id="fairness1" name="fairness" value="1">
                                <label for="fairness1">1<br>非常不公平</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness2" name="fairness" value="2">
                                <label for="fairness2">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness3" name="fairness" value="3">
                                <label for="fairness3">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness4" name="fairness" value="4">
                                <label for="fairness4">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness5" name="fairness" value="5">
                                <label for="fairness5">5</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness6" name="fairness" value="6">
                                <label for="fairness6">6</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="fairness7" name="fairness" value="7">
                                <label for="fairness7">7<br>非常公平</label>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="nextTrial()" style="margin-top: 30px;">继续 (空格键)</button>
                </div>
            </div>
        </div>
        
        <!-- 屏幕9: 理解测试 -->
        <div id="screen9" class="screen">
            <div class="center-content">
                <h1>理解测试</h1>
                <p>请回答以下问题，以确保您完全理解实验规则。</p>
                
                <div class="comprehension-question">
                    <h3>第一题：在这个任务中，您扮演什么角色？</h3>
                    <div class="comprehension-options">
                        <div class="comprehension-option">
                            <input type="radio" id="q1a" name="q1" value="A">
                            <label for="q1a">A. 提议者：我决定如何分配钱。</label>
                        </div>
                        <div class="comprehension-option">
                            <input type="radio" id="q1b" name="q1" value="B">
                            <label for="q1b">B. 回应者：我可以选择接受或拒绝对方提出的分配方案。</label>
                        </div>
                        <div class="comprehension-option">
                            <input type="radio" id="q1c" name="q1" value="C">
                            <label for="q1c">C. 第三方：我观察别人的分配并决定是否惩罚。</label>
                        </div>
                    </div>
                </div>
                
                <div class="comprehension-question">
                    <h3>第二题：如果您选择拒绝一个【提议者得8元，您得2元】的方案，最终结果是什么？</h3>
                    <div class="comprehension-options">
                        <div class="comprehension-option">
                            <input type="radio" id="q2a" name="q2" value="A">
                            <label for="q2a">A. 您和提议者都得到0元。</label>
                        </div>
                        <div class="comprehension-option">
                            <input type="radio" id="q2b" name="q2" value="B">
                            <label for="q2b">B. 您得到2元，提议者得到8元。</label>
                        </div>
                        <div class="comprehension-option">
                            <input type="radio" id="q2c" name="q2" value="C">
                            <label for="q2c">C. 系统会为您分配一个更公平的新方案。</label>
                        </div>
                    </div>
                </div>
                
                <button class="btn" onclick="checkComprehension()">提交答案</button>
            </div>
        </div>
        
        <!-- 屏幕10: 不确定性容忍度量表 -->
        <div id="screen10" class="screen">
            <div class="center-content">
                <h1>不确定性容忍度量表</h1>
                <p>请仔细阅读下面的句子，选择在最符合您情况的选项上打"√"。其中1表示"完全不符合",2表示"比较不符合",3表示"有点符合",4表示"比较符合",5表示"完全符合"。(请不要多选或漏选)</p>
                
                <table class="questionnaire-table">
                    <thead>
                        <tr>
                            <th width="60%">题目</th>
                            <th>1<br>完全不符合</th>
                            <th>2<br>比较不符合</th>
                            <th>3<br>有点符合</th>
                            <th>4<br>比较符合</th>
                            <th>5<br>完全符合</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="text-align: left;">1. 无法预料的事情会让我心烦意乱。</td>
                            <td><input type="radio" name="q1" value="1"></td>
                            <td><input type="radio" name="q1" value="2"></td>
                            <td><input type="radio" name="q1" value="3"></td>
                            <td><input type="radio" name="q1" value="4"></td>
                            <td><input type="radio" name="q1" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">2. 如果不能拥有我所需要的全部信息，我会很沮丧。</td>
                            <td><input type="radio" name="q2" value="1"></td>
                            <td><input type="radio" name="q2" value="2"></td>
                            <td><input type="radio" name="q2" value="3"></td>
                            <td><input type="radio" name="q2" value="4"></td>
                            <td><input type="radio" name="q2" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">3. 不确定性让我过得不好。</td>
                            <td><input type="radio" name="q3" value="1"></td>
                            <td><input type="radio" name="q3" value="2"></td>
                            <td><input type="radio" name="q3" value="3"></td>
                            <td><input type="radio" name="q3" value="4"></td>
                            <td><input type="radio" name="q3" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">4. 我做事总会未雨绸缪，以避免措手不及。</td>
                            <td><input type="radio" name="q4" value="1"></td>
                            <td><input type="radio" name="q4" value="2"></td>
                            <td><input type="radio" name="q4" value="3"></td>
                            <td><input type="radio" name="q4" value="4"></td>
                            <td><input type="radio" name="q4" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">5. 即使有最好的计划，一个小意外也能搞砸我的全盘计划。</td>
                            <td><input type="radio" name="q5" value="1"></td>
                            <td><input type="radio" name="q5" value="2"></td>
                            <td><input type="radio" name="q5" value="3"></td>
                            <td><input type="radio" name="q5" value="4"></td>
                            <td><input type="radio" name="q5" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">6. 当到了采取行动的时候，不确定性会让我停滞不前。</td>
                            <td><input type="radio" name="q6" value="1"></td>
                            <td><input type="radio" name="q6" value="2"></td>
                            <td><input type="radio" name="q6" value="3"></td>
                            <td><input type="radio" name="q6" value="4"></td>
                            <td><input type="radio" name="q6" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">7. 当我感到不确定时，我就不能很好地表现自己。</td>
                            <td><input type="radio" name="q7" value="1"></td>
                            <td><input type="radio" name="q7" value="2"></td>
                            <td><input type="radio" name="q7" value="3"></td>
                            <td><input type="radio" name="q7" value="4"></td>
                            <td><input type="radio" name="q7" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">8. 我总是想知道我的未来是什么样子的。</td>
                            <td><input type="radio" name="q8" value="1"></td>
                            <td><input type="radio" name="q8" value="2"></td>
                            <td><input type="radio" name="q8" value="3"></td>
                            <td><input type="radio" name="q8" value="4"></td>
                            <td><input type="radio" name="q8" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">9. 我无法忍受突发状况。</td>
                            <td><input type="radio" name="q9" value="1"></td>
                            <td><input type="radio" name="q9" value="2"></td>
                            <td><input type="radio" name="q9" value="3"></td>
                            <td><input type="radio" name="q9" value="4"></td>
                            <td><input type="radio" name="q9" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">10. 一点点的疑惑都会阻止我行动。</td>
                            <td><input type="radio" name="q10" value="1"></td>
                            <td><input type="radio" name="q10" value="2"></td>
                            <td><input type="radio" name="q10" value="3"></td>
                            <td><input type="radio" name="q10" value="4"></td>
                            <td><input type="radio" name="q10" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">11. 在做事之前，我应该能够规划好一切。</td>
                            <td><input type="radio" name="q11" value="1"></td>
                            <td><input type="radio" name="q11" value="2"></td>
                            <td><input type="radio" name="q11" value="3"></td>
                            <td><input type="radio" name="q11" value="4"></td>
                            <td><input type="radio" name="q11" value="5"></td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">12. 我必须摆脱所有不确定的情形。</td>
                            <td><input type="radio" name="q12" value="1"></td>
                            <td><input type="radio" name="q12" value="2"></td>
                            <td><input type="radio" name="q12" value="3"></td>
                            <td><input type="radio" name="q12" value="4"></td>
                            <td><input type="radio" name="q12" value="5"></td>
                        </tr>
                    </tbody>
                </table>
                
                <button class="btn" onclick="saveQuestionnaire()">提交问卷</button>
            </div>
        </div>
        
        <!-- 屏幕11: 邮箱和手机号提示页面 -->
        <div id="screen11" class="screen">
            <div class="center-content">
                <h1>实验完成，感谢您的参与！</h1>
                <div class="instructions">
                    <p>请将实验数据文件和您的手机号发送到主试邮箱：</p>
                    <button class="copy-email" onclick="copyEmail()">17302724184@163.com（点击复制）</button>
                    
                    <div class="email-instructions">
                        <h3>发送邮件说明：</h3>
                        <ul>
                            <li>请将下载的实验数据文件作为附件</li>
                            <li>在邮件<strong>主题或内容</strong>中注明您的<strong>手机号</strong></li>
                            <li>手机号将用于后续支付被试费</li>
                        </ul>
                    </div>
                    
                    <p>点击下方按钮下载您的实验数据文件：</p>
                    <button class="btn" onclick="downloadData()">下载实验数据</button>
                </div>
                <div id="download-status" style="margin: 30px 0; padding: 20px; border-radius: 15px; background-color: #e9f7ef; color: #2d5016; display: none; font-size: 1.3rem;">
                    数据下载成功！
                </div>
            </div>
        </div>
        
        <!-- 屏幕12: 最终完成页面 -->
        <div id="screen12" class="screen">
            <div class="center-content">
                <h1>实验已完成</h1>
                <div class="instructions">
                    <p>感谢您的参与！祝您生活愉快！</p>
                </div>
            </div>
        </div>
        
        <!-- 图片呈现容器 - 独立于其他屏幕 -->
        <div id="image-presentation" class="image-container" style="display: none;">
            <img id="trial-image" class="trial-image" src="" alt="实验图片">
        </div>
    </div>

    <script>
        // 实验数据存储
        const experimentData = {
            participantId: '',
            demographics: {
                age: '',
                gender: '',
                major: '',
                education: '',
                health: ''
            },
            comprehension: {
                q1: '',
                q2: '',
                q1Correct: false,
                q2Correct: false
            },
            uncertaintyTolerance: {},
            matchedParticipant: 0,
            practiceTrials: [],
            trials: [],
            currentTrial: 0,
            startTime: null,
            group: '' // 记录被试被分配到的组别
        };
        
        // 分配方案
        const proposals = [
            { other: 5, self: 5 },
            { other: 6, self: 4 },
            { other: 7, self: 3 },
            { other: 8, self: 2 },
            { other: 9, self: 1 }
        ];
        
        // 图片分组配置 - 使用相对路径
        const imageGroups = {
            // 陌生组 - 图片命名为01.jpeg, 02.jpeg, ..., 020.jpg
            mosheng: {
                name: "陌生",
                images: [
                    '01.jpeg', '02.jpeg', '03.jpeg', '04.jpeg', '05.jpeg',
                    '06.jpeg', '07.jpeg', '08.jpeg', '09.jpeg', '010.jpeg',
                    '011.jpeg', '012.jpeg', '013.jpg', '014.jpeg', '015.jpg',
                    '016.png', '017.jpg', '018.jpeg', '019.jpeg', '020.jpg'
                ]
            },
            // 熟悉组 - 图片命名为1.jpeg, 2.jpeg, ..., 20.jpeg
            shuxi: {
                name: "熟悉",
                images: [
                    '1.jpeg', '2.jpeg', '3.jpeg', '4.jpeg', '5.jpeg',
                    '6.jpeg', '7.jpeg', '8.jpeg', '9.jpeg', '10.jpeg',
                    '11.png', '12.JPG', '13.png', '14.jpeg', '15.jpg',
                    '16.JPG', '17.jpeg', '18.jpeg', '19.jpeg', '20.jpeg'
                ]
            }
        };
        
        // 创建试次序列
        let trialSequence = [];
        
        // 预加载图片
        function preloadImages(group) {
            const images = [];
            for (let i = 0; i < group.images.length; i++) {
                const img = new Image();
                img.src = group.images[i];
                images.push(img);
            }
            return images;
        }
        
        // 工具函数：随机打乱数组
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // 屏幕切换函数
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // 年龄验证函数
        function validateAge(input) {
            // 只允许输入数字
            input.value = input.value.replace(/[^0-9]/g, '');
            
            // 限制年龄范围（1-120）
            const age = parseInt(input.value);
            if (age > 120) {
                input.value = '120';
            }
        }
        
        // 显示人口学信息页面
        function showDemographics() {
            const participantId = document.getElementById('participant-id').value;
            if (!participantId) {
                alert('请输入您的实验编号');
                return;
            }
            
            experimentData.participantId = participantId;
            showScreen('screen2');
        }
        
        // 保存人口学信息
        function saveDemographics() {
            const age = document.getElementById('age').value;
            const gender = document.querySelector('input[name="gender"]:checked');
            const major = document.getElementById('major').value;
            const education = document.getElementById('education').value;
            const health = document.getElementById('health').value;
            
            if (!age) {
                alert('请输入您的年龄');
                return;
            }
            
            if (!gender) {
                alert('请选择您的性别');
                return;
            }
            
            if (!major) {
                alert('请选择您的专业');
                return;
            }
            
            if (!education) {
                alert('请选择您的学历');
                return;
            }
            
            // 保存人口学信息
            experimentData.demographics = {
                age: age,
                gender: gender.value,
                major: major,
                education: education,
                health: health
            };
            
            experimentData.startTime = new Date();
            
            // 随机分配被试到图片组
            const groupKeys = Object.keys(imageGroups);
            const randomGroupKey = groupKeys[Math.floor(Math.random() * groupKeys.length)];
            experimentData.group = imageGroups[randomGroupKey];
            
            // 预加载图片
            preloadImages(experimentData.group);
            
            // 创建试次序列
            trialSequence = [];
            
            // 复制图片数组并随机打乱
            const shuffledImages = shuffleArray([...experimentData.group.images]);
            
            for (let i = 0; i < 4; i++) {
                proposals.forEach(proposal => {
                    // 计算图片索引 (0到19)
                    const imageIndex = i * 5 + proposals.indexOf(proposal);
                    trialSequence.push({
                        ...proposal,
                        imagePath: shuffledImages[imageIndex],
                        imageId: imageIndex + 1
                    });
                });
            }
            
            // 随机化试次顺序
            trialSequence = shuffleArray(trialSequence);
            
            showScreen('screen3');
        }
        
        function startNetwork() {
            showScreen('screen4');
            
            // 模拟网络连接延迟
            setTimeout(() => {
                // 随机生成匹配的参与者编号
                experimentData.matchedParticipant = Math.floor(Math.random() * 36) + 1;
                document.getElementById('matched-participant').textContent = experimentData.matchedParticipant;
                showScreen('screen5');
            }, 2000);
        }
        
        function startPractice() {
            showScreen('screen6');
            // 随机选择一个分配方案用于练习
            const practiceProposal = proposals[Math.floor(Math.random() * proposals.length)];
            document.getElementById('practice-proposal').innerHTML = 
                `对方得到: ${practiceProposal.other}虚拟币<br>您得到: ${practiceProposal.self}虚拟币`;
            
            // 存储练习试次数据
            experimentData.currentPractice = practiceProposal;
        }
        
        function practiceDecision(decision) {
            const practice = experimentData.currentPractice;
            let feedbackText = '';
            
            if (decision === 'accept') {
                feedbackText = `您接受该提议，对方得到${practice.other}虚拟币，您得到${practice.self}虚拟币`;
            } else {
                feedbackText = `您拒绝该提议，双方都得到0虚拟币`;
            }
            
            document.getElementById('practice-feedback').textContent = feedbackText;
            
            // 记录练习试次数据
            experimentData.practiceTrials.push({
                proposal: practice,
                decision: decision,
                timestamp: new Date()
            });
            
            showScreen('screen7');
        }
        
        function continuePractice() {
            startPractice();
        }
        
        function startExperiment() {
            showScreen('screen8');
            runTrial(0);
        }
        
        function runTrial(trialIndex) {
            experimentData.currentTrial = trialIndex;
            const trial = trialSequence[trialIndex];
            
            // 更新进度和计数器
            document.getElementById('progress-bar').style.width = `${(trialIndex + 1) / trialSequence.length * 100}%`;
            document.getElementById('trial-counter').textContent = `试次 ${trialIndex + 1} / ${trialSequence.length}`;
            
            // 更新图片 - 使用相对路径
            document.getElementById('trial-image').src = trial.imagePath;
            document.getElementById('trial-image').alt = `实验图片 ${trial.imageId}`;
            
            // 更新分配方案
            document.getElementById('trial-proposal').innerHTML = 
                `对方得到: ${trial.other}虚拟币<br>您得到: ${trial.self}虚拟币`;
            
            // 重置公平性评分
            document.querySelectorAll('input[name="fairness"]').forEach(radio => {
                radio.checked = false;
            });
            
            // 显示注视点
            document.getElementById('fixation').style.display = 'block';
            document.getElementById('proposal').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('fairness-rating').style.display = 'none';
            
            // 注视点显示500ms
            setTimeout(() => {
                document.getElementById('fixation').style.display = 'none';
                
                // 显示全屏图片
                document.getElementById('image-presentation').style.display = 'flex';
                
                // 图片显示2000ms
                setTimeout(() => {
                    // 隐藏图片
                    document.getElementById('image-presentation').style.display = 'none';
                    
                    // 白屏500ms
                    setTimeout(() => {
                        document.getElementById('proposal').style.display = 'block';
                    }, 500);
                }, 2000);
            }, 500);
            
            // 存储试次开始时间
            experimentData.currentTrialStart = new Date();
        }
        
        function makeDecision(decision) {
            const trialIndex = experimentData.currentTrial;
            const trial = trialSequence[trialIndex];
            
            let feedbackText = '';
            if (decision === 'accept') {
                feedbackText = `您接受该提议，对方得到${trial.other}虚拟币，您得到${trial.self}虚拟币`;
            } else {
                feedbackText = `您拒绝该提议，双方都得到0虚拟币`;
            }
            
            document.getElementById('trial-feedback').textContent = feedbackText;
            document.getElementById('proposal').style.display = 'none';
            document.getElementById('feedback').style.display = 'block';
            
            // 记录决策和反应时间
            const reactionTime = new Date() - experimentData.currentTrialStart;
            
            // 存储试次数据
            experimentData.trials.push({
                trialIndex: trialIndex,
                proposal: trial,
                decision: decision,
                reactionTime: reactionTime,
                timestamp: new Date()
            });
            
            // 反馈显示1000ms后显示公平性评分
            setTimeout(() => {
                document.getElementById('feedback').style.display = 'none';
                document.getElementById('fairness-rating').style.display = 'block';
            }, 1000);
        }
        
        function nextTrial() {
            // 获取公平性评分
            const selectedFairness = document.querySelector('input[name="fairness"]:checked');
            if (!selectedFairness) {
                alert('请选择公平性评分');
                return;
            }
            
            // 记录公平性评分
            experimentData.trials[experimentData.currentTrial].fairness = parseInt(selectedFairness.value);
            
            // 检查是否所有试次都已完成
            if (experimentData.currentTrial < trialSequence.length - 1) {
                runTrial(experimentData.currentTrial + 1);
            } else {
                showComprehensionTest();
            }
        }
        
        function showComprehensionTest() {
            showScreen('screen9');
        }
        
        function checkComprehension() {
            const q1Answer = document.querySelector('input[name="q1"]:checked');
            const q2Answer = document.querySelector('input[name="q2"]:checked');
            
            if (!q1Answer || !q2Answer) {
                alert('请回答所有问题');
                return;
            }
            
            // 记录答案并检查正确性
            experimentData.comprehension.q1 = q1Answer.value;
            experimentData.comprehension.q2 = q2Answer.value;
            experimentData.comprehension.q1Correct = (q1Answer.value === 'B');
            experimentData.comprehension.q2Correct = (q2Answer.value === 'A');
            
            // 无论答案是否正确，都继续实验
            showUncertaintyToleranceQuestionnaire();
        }
        
        function showUncertaintyToleranceQuestionnaire() {
            showScreen('screen10');
        }
        
        function saveQuestionnaire() {
            // 收集不确定性容忍度量表数据
            for (let i = 1; i <= 12; i++) {
                const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
                if (!selectedOption) {
                    alert(`请回答第${i}题`);
                    return;
                }
                experimentData.uncertaintyTolerance[`q${i}`] = parseInt(selectedOption.value);
            }
            
            showScreen('screen11');
        }
        
        // 复制邮箱到剪贴板
        function copyEmail() {
            const email = '17302724184@163.com';
            navigator.clipboard.writeText(email).then(() => {
                alert('邮箱地址已复制到剪贴板');
            }).catch(err => {
                console.error('复制失败:', err);
                // 备用方法
                const textArea = document.createElement('textarea');
                textArea.value = email;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('邮箱地址已复制到剪贴板');
            });
        }
        
        // 生成CSV数据
        function generateCSV() {
            let csvContent = "参与者编号,年龄,性别,专业,学历,健康状态,匹配参与者,分组,理解测试1答案,理解测试1正确,理解测试2答案,理解测试2正确,试次,分配方案(对方),分配方案(自己),决策,反应时间(ms),公平性评分,时间戳,图片文件名";
            
            // 添加不确定性容忍度量表标题
            for (let i = 1; i <= 12; i++) {
                csvContent += `,不确定性容忍度${i}`;
            }
            
            csvContent += "\n";
            
            // 添加实验数据
            experimentData.trials.forEach(trial => {
                let row = `"${experimentData.participantId}","${experimentData.demographics.age}","${experimentData.demographics.gender}","${experimentData.demographics.major}","${experimentData.demographics.education}","${experimentData.demographics.health}","${experimentData.matchedParticipant}","${experimentData.group.name}","${experimentData.comprehension.q1}","${experimentData.comprehension.q1Correct}","${experimentData.comprehension.q2}","${experimentData.comprehension.q2Correct}","${trial.trialIndex + 1}","${trial.proposal.other}","${trial.proposal.self}","${trial.decision}","${trial.reactionTime}","${trial.fairness}","${trial.timestamp}","${trial.proposal.imagePath}"`;
                
                // 添加不确定性容忍度量表数据
                for (let i = 1; i <= 12; i++) {
                    row += `,"${experimentData.uncertaintyTolerance[`q${i}`] || ''}"`;
                }
                
                row += "\n";
                csvContent += row;
            });
            
            return csvContent;
        }
        
        // 下载CSV文件
        function downloadData() {
            const csvContent = generateCSV();
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            
            link.setAttribute("href", url);
            link.setAttribute("download", `最后通牒实验_${experimentData.participantId}_${experimentData.group.name}组_${timestamp}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // 显示下载成功状态
            document.getElementById('download-status').style.display = 'block';
            
            // 延迟后自动跳转到最终完成页面
            setTimeout(() => {
                showScreen('screen12');
            }, 2000);
        }
        
        // 模拟数据上传到服务器
        function uploadDataToServer() {
            // 在实际应用中，这里应该是一个真实的API端点
            // 例如：fetch('https://your-api.com/upload-data', { method: 'POST', body: generateCSV() })
            
            // 这里我们只是模拟上传过程
            return new Promise((resolve) => {
                setTimeout(() => {
                    // 在实际应用中，这里应该检查响应状态
                    resolve(true);
                }, 1500);
            });
        }
        
        function restartExperiment() {
            // 重置实验数据
            experimentData.participantId = '';
            experimentData.demographics = {
                age: '',
                gender: '',
                major: '',
                education: '',
                health: ''
            };
            experimentData.comprehension = {
                q1: '',
                q2: '',
                q1Correct: false,
                q2Correct: false
            };
            experimentData.uncertaintyTolerance = {};
            experimentData.matchedParticipant = 0;
            experimentData.practiceTrials = [];
            experimentData.trials = [];
            experimentData.currentTrial = 0;
            experimentData.startTime = null;
            experimentData.group = '';
            
            // 回到第一个屏幕
            showScreen('screen1');
            document.getElementById('participant-id').value = '';
            document.getElementById('download-status').style.display = 'none';
        }
        
        // 键盘事件监听
        document.addEventListener('keydown', function(event) {
            // 屏幕1：按空格键开始实验说明
            if (document.getElementById('screen1').classList.contains('active') && event.key === ' ') {
                showDemographics();
            }
            
            // 屏幕3：按空格键开始网络连接
            if (document.getElementById('screen3').classList.contains('active') && event.key === ' ') {
                startNetwork();
            }
            
            // 屏幕5：按空格键开始练习
            if (document.getElementById('screen5').classList.contains('active') && event.key === ' ') {
                startPractice();
            }
            
            // 练习阶段的按键
            if (document.getElementById('screen6').classList.contains('active')) {
                if (event.key === 'f' || event.key === 'F') {
                    practiceDecision('accept');
                } else if (event.key === 'j' || event.key === 'J') {
                    practiceDecision('reject');
                }
            }
            
            // 练习反馈阶段的按键
            if (document.getElementById('screen7').classList.contains('active')) {
                if (event.key === ' ') {
                    startExperiment();
                } else if (event.key === 'q' || event.key === 'Q') {
                    continuePractice();
                }
            }
            
            // 理解测试阶段按空格键提交
            if (document.getElementById('screen9').classList.contains('active') && event.key === ' ') {
                checkComprehension();
            }
            
            // 正式实验决策阶段的按键
            if (document.getElementById('proposal').style.display === 'block') {
                if (event.key === 'f' || event.key === 'F') {
                    makeDecision('accept');
                } else if (event.key === 'j' || event.key === 'J') {
                    makeDecision('reject');
                }
            }
            
            // 公平性评分阶段按空格键继续
            if (document.getElementById('fairness-rating').style.display === 'block' && event.key === ' ') {
                nextTrial();
            }
            
            // 不确定性容忍度量表按空格键提交
            if (document.getElementById('screen10').classList.contains('active') && event.key === ' ') {
                saveQuestionnaire();
            }
            
            // 屏幕11按空格键下载数据
            if (document.getElementById('screen11').classList.contains('active') && event.key === ' ') {
                downloadData();
            }
        });
    </script>
</body>
</html>